apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  labels:
    run: mender-elasticsearch5
  name: mender-elasticsearch5
spec:
  # Stateful application, cannot go beyond single instance without special setup.
  replicas: 1
  selector:
    matchLabels:
      run: mender-elasticsearch5

  # if deployment is not completed within 5 min, consider it failed,
  # as result deployment Reason=ProgressDeadlineExceeded
  # needs to be big enough to rollout to complete
  progressDeadlineSeconds: 300
  
  # Rollout upgrade one by one
  # In case any issues, they will be detected early and deployment be stopped.
  strategy:
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0

  template:
    metadata:
      labels:
        run: mender-elasticsearch5
    spec:
      initContainers:
       - command:
         - sysctl
         - -w
         - vm.max_map_count=262144
       ***REMOVED*** busybox
         imagePullPolicy: IfNotPresent
         name: sysctlinit
         resources: {}
         securityContext:
           privileged: true
           runAsUser: 0

      containers:
      - name: mender-elasticsearch5
        env:
        - name: ES_JAVA_OPTS
          value: "-Xms512m -Xmx512m"
 
        - name: transport.host
          value: "0.0.0.0"

        - name: network.host
          value: "0.0.0.0"

        - name: discovery.type
          value: "single-node"

        - name: xpack.security.enabled
          value: "false"

      ***REMOVED*** docker.elastic.co/elasticsearch/elasticsearch:5.6.16

        resources:
          requests:
            memory: "1024M"

        volumeMounts:
        - name: data
          mountPath: "/usr/share/elasticsearch/data"

      volumes:		
      - name: data
        emptyDir: {}
status: {}


